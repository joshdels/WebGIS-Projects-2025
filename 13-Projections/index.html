<!DOCTYPE html>
<html lang="en">
<head>
    <title>Day 30 | Makeover</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.13.0/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@5.13.0/dist/maplibre-gl.js'></script>

    <style>
        body { margin:0; padding:0; font-family: sans-serif; }
        html, body, #map { height:100%; }

        /* Toggle button */
        .toggle-btn {
            position: absolute;
            top: 12px;
            left: 12px;
            z-index: 10;
            padding: 8px 14px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Title */
        #title {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 20px;
            background: rgba(0,0,0,0.6);
            color: white;
            font-size: 20px;
            z-index: 10;
            border-radius: 8px;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        /* Legend box */
        #legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 20;
            background: rgba(0,0,0,0.65);
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            line-height: 1.5;
            box-shadow: 0 0 8px rgba(0,0,0,0.3);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            border-radius: 3px;
            border: 1px solid white;
        }

        #map {
            background-color: rgb(29, 29, 29);
        }
    </style>
</head>

<body>

<button id="toggleProjection" class="toggle-btn">Switch to Flat</button>
<div id="title">Railways & Ports</div>

<!-- Legend -->
<div id="legend">
    <div class="legend-item">
        <div class="legend-color" style="background:pink;"></div> Railways
    </div>
    <div class="legend-item">
        <div class="legend-color" style="background:yellow;"></div> Ports
    </div>
</div>

<div id="map">
    this is a map
</div>

<script>
const map = new maplibregl.Map({
    container: 'map',
    style: 'https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json',
    center: [0, 0],
    zoom: 2
});

let isGlobe = true;

// Dark sky for globe mode
function addGlobeBackdrop() {
    if (!map.getLayer('sky')) {
        map.addLayer({
            id: 'sky',
            type: 'sky',
            paint: {
                'sky-type': 'gradient',
                'sky-gradient': [
                    'interpolate', ['linear'], ['sky-radial-progress'],
                    0.0, 'rgba(0,0,0,1)',
                    0.8, 'rgba(0,0,30,0.8)',
                    1.0, 'rgba(0,0,60,0.6)'
                ],
                'sky-opacity': 1.0
            }
        });
    }
}

map.on("style.load", () => {
    map.setProjection({ type: "globe" });

    if (map.setLight) {
        map.setLight({
            intensity: 0.5,
            color: "#ffffff"
        });
    }

    addGlobeBackdrop();

    // Load data
    if (!map.getSource("railroads")) {
        map.addSource("railroads", {
            type: "geojson",
            data: "./railroads.geojson"
        });

        map.addSource("ports", {
            type: "geojson",
            data: "./ports.geojson"
        });

        map.addLayer({
            id: 'port-points',
            type: 'circle',
            source: 'ports',
            paint: {
                'circle-radius': 3,
                'circle-color': 'yellow',
                'circle-stroke-width': 1
            }
        });

        map.addLayer({
            id: "railroads-line",
            type: "line",
            source: "railroads",
            paint: {
                "line-color": "pink",
                "line-width": 1.8,
                "line-opacity": 0.9
            }
        });
    }
});

// Toggle projection
document.getElementById("toggleProjection").onclick = () => {
    isGlobe = !isGlobe;

    if (isGlobe) {
        map.setProjection({ type: "globe" });
        addGlobeBackdrop();
        document.getElementById("toggleProjection").innerText = "Switch to Flat";
    } else {
        map.setProjection({ type: "mercator" });
        if (map.getLayer('sky')) map.removeLayer('sky');
        document.getElementById("toggleProjection").innerText = "Switch to Globe";
    }
};
</script>
</body>
</html>
