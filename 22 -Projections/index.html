<!DOCTYPE html>
<html lang="en">
<head>
    <title>Railroads + Globe Toggle + Dark Backdrop</title>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.13.0/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@5.13.0/dist/maplibre-gl.js'></script>

    <style>
        body { margin:0; padding:0; }
        html, body, #map { height:100%; }

        .toggle-btn {
            position: absolute;
            top: 12px;
            left: 12px;
            z-index: 10;
            padding: 8px 14px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }

        #map { height:100%; background-color: rgb(139, 139, 139); }
    </style>
</head>

<body>

<button id="toggleProjection" class="toggle-btn">Switch to Flat</button>
<div id="map"></div>

<script>
const map = new maplibregl.Map({
    container: 'map',
    style: 'https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json',
    center: [0, 0],
    zoom: 2
});

// Track state
let isGlobe = true;

// Function to add a dark globe sky background
function addGlobeBackdrop() {
    if (!map.getLayer('sky')) {
        map.addLayer({
            'id': 'sky',
            'type': 'sky',
            'paint': {
                'sky-type': 'gradient',
                'sky-gradient': ['interpolate', ['linear'], ['sky-radial-progress'],
                    0.0, 'rgba(0,0,0,1)',
                    0.8, 'rgba(0,0,30,0.8)',
                    1.0, 'rgba(0,0,60,0.6)'
                ],
                'sky-opacity': 1.0
            }
        });
    }
}

// Load style + apply globe first time
map.on("style.load", () => {
    map.setProjection({ type: "globe" });

    // Soft lighting
    if (map.setLight) {
        map.setLight({
            intensity: 0.5,
            color: "#ffffff"
        });
    }

    addGlobeBackdrop();

    // Load railroads if not already added
    if (!map.getSource("railroads")) {
        map.addSource("railroads", {
            type: "geojson",
            data: "./railroads.geojson"
        });

        map.addLayer({
            id: "railroads-line",
            type: "line",
            source: "railroads",
            paint: {
                "line-color": "white",
                "line-width": 1.8,
                "line-opacity": 0.9
            }
        });
    }
});

// Toggle button handler
document.getElementById("toggleProjection").onclick = () => {
    isGlobe = !isGlobe;

    if (isGlobe) {
        map.setProjection({ type: "globe" });
        addGlobeBackdrop(); // add dark sky
        document.getElementById("toggleProjection").innerText = "Switch to Flat";
    } else {
        map.setProjection({ type: "mercator" });
        // remove sky layer in flat mode if exists
        if (map.getLayer('sky')) {
            map.removeLayer('sky');
        }
        document.getElementById("toggleProjection").innerText = "Switch to Globe";
    }
};
</script>
</body>
</html>
